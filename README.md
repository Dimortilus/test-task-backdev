
## Test task BackDev
Тестовое задание на позицию Junior Backend Developer

#### Используемые технологии:
<ul>
<li>Go</li>
<li>JWT</li>
<li>MongoDB</li>
</ul>

#### Задание:
Написать часть сервиса аутентификации.</br>
Два REST маршрута:</br>
<ul>
<li>Первый маршрут выдает пару Access, Refresh токенов для пользователя с идентификатором (GUID) указанным в параметре запроса</li>
<li>Второй маршрут выполняет Refresh операцию на пару Access, Refresh токенов</li>
</ul>

#### Требования:
Access токен тип JWT, алгоритм SHA512, хранить в базе строго запрещено.</br>
Refresh токен тип произвольный, формат передачи base64, хранится в базе исключительно в виде bcrypt хеша, должен быть защищен от изменения настороне клиента и попыток повторного использования.</br>
Access, Refresh токены обоюдно связаны, Refresh операцию для Access токена можно выполнить только тем Refresh токеном который был выдан вместе с ним.

#### Описание решения:
<ul>
    <li>
    Формат Refresh токена: случайная последовательность из 32 байт.</br>
    Для каждого токена генерируется новая последовательность.</br>
    Такой тип токенов, судя по всему, называется "opaque token", или "reference token".</br>
    </li>
    <li>На клиенте оба типа токенов хранятся в httpOnly cookies.</li>
    <li>Схема "один пользователь - один Refresh токен".</br>
    В Mongo хранится <em>документ</em> <code>{ GUID, bcrypt(refreshToken), exp }</code></br>
    Хранить GUID необходимо для возможности досрочного отзыва Refresh токена конкретного пользователя.</br>
    Хранить exp (expirtaion time) необходимо для проверки Refresh токена на предмет истечения срока годности.</li>
    <li>POST запрос по маршруту <code>/generate-tokens</code>.</br> 
    Сервер извлекает GUID из JSON тела запроса.</br>
        <ol>
            <li>Генерирует новую пару Access-Refresh токенов.</li>
            <li>Выполняет upsert <em>документа</em> по GUID в Mongo.</li>
            <li>Кодирует Refresh токен в base64.</li>
            <li>Сохраняет токены в cookies пользователя.</li>
        </ol>
    </li>
    <li>POST запрос по маршруту <code>/refresh-tokens</code>.</br>
    Сервер извлекает GUID из JSON тела запроса.</br>
    Ищет в Mongo <em>документ</em> по GUID.</br>
    Если <em>документ</em> НЕ найден, отказывает в выдаче токенов.</br>
    Если <em>документ</em> найден:</br>
    - Извлекает из cookies Refresh токен, декодирует из base64.</br> 
    - Проверяет токен bcrypt хешем в Mongo.</br>
    - Проверяет не истёк ли у токена срок годности</br>
    Если валидация прошла успешно:
        <ol>
            <li>Генерирует новую пару Access-Refresh токенов.</li>
            <li>Выполняет upsert <em>документа</em> по GUID в Mongo.</li>
            <li>Кодирует Refresh токен в base64.</li>
            <li>Сохраняет токены в cookies пользователя.</li>
        </ol>
    </li>
    <li>POST запрос по маршруту <code>/test-access-token</code>.</br>
    Сервер извлекает Access токен из cookies, выполняет парсинг и валидацию токена (подпись, срок годности).
    </li>
    <li>
    Переменная ACCESS_TOKEN_SECRET в .env файле заполнена тестовым ключом в виде HEX-строки.</br>
    В соответствии с рекомендациями, длина ключа для алгоритма SHA512 составляет 1024 бит.
    </li>
</ul>